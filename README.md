# bil-cs2-auth

# üõ°Ô∏è Auth Service

–°–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **JWT** —Ç–æ–∫–µ–Ω–æ–≤ –∏ **PostgreSQL**.  
–†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –Ω–∞ **FastAPI** —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ–º —á–µ—Ä–µ–∑ **SQLAlchemy** –∏ **asyncpg**.

---

## üéØ –¶–µ–ª—å

–°–æ–∑–¥–∞—Ç—å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π:
- —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π,
- –≤—Ö–æ–¥ –ø–æ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—é,
- –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –ø—Ä–æ–≤–µ—Ä–∫—É JWT —Ç–æ–∫–µ–Ω–æ–≤,
- –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt),
- –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö PostgreSQL —á–µ—Ä–µ–∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π ORM SQLAlchemy.

---

## üß© –ó–∞–¥–∞—á–∏

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å REST API –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –∏ –≤—Ö–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.  
2. –û–±–µ—Å–ø–µ—á–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å –ø–æ–º–æ—â—å—é **Pydantic**.  
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **JWT** –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–æ–∫–µ–Ω–æ–≤.  
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Å—Ç–∏–ª–µ **Clean Architecture**:  
   - `routers/` ‚Äî API –º–∞—Ä—à—Ä—É—Ç—ã  
   - `services/` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞  
   - `repositories/` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π  
   - `engines/` ‚Äî –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö  
5. –ü–æ–∫—Ä—ã—Ç—å –∫–æ–¥ —Ç–µ—Å—Ç–∞–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **pytest** –∏ **pytest-asyncio**.  
6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ middleware.

---

## ‚öôÔ∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-----------|
| **Python 3.11** | –Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è |
| **FastAPI** | –í–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è REST API |
| **Uvicorn** | ASGI-—Å–µ—Ä–≤–µ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| **SQLAlchemy (async)** | ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö |
| **asyncpg** | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä PostgreSQL |
| **Pydantic v2** | –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö |
| **PyJWT** | –†–∞–±–æ—Ç–∞ —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏ |
| **bcrypt** | –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π |
| **pytest / pytest-asyncio** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã |
| **Ruff / Autoflake** | –õ–∏–Ω—Ç–µ—Ä –∏ –∞–≤—Ç–æ—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ |
| **Testcontainers** | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–º PostgreSQL |

---

## üåê REST API

| ‚Ññ | –û–ø–∏—Å–∞–Ω–∏–µ | –ú–µ—Ç–æ–¥ | –≠–Ω–¥–ø–æ–∏–Ω—Ç | –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ | –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ |
|---|-----------|--------|-----------|----------------|----------------|
| 1 | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `POST` | `/auth/register` | ```json { "username": "user1", "password": "secret123" } ``` | |
| 2 | –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–ø–æ–ª—É—á–µ–Ω–∏–µ JWT) | `POST` | `/auth/login` | ```json { "username": "user1", "password": "secret123" } ``` | ```json { "token": "eyJhbGciOiJIUzI1..." } ``` |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ engines                        # –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                # –î–µ–ª–∞–µ—Ç –ø–∞–ø–∫—É –º–æ–¥—É–ª–µ–º Python
‚îÇ   ‚îú‚îÄ‚îÄ postgres.py                # –õ–æ–≥–∏–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å PostgreSQL
‚îÇ   ‚îî‚îÄ‚îÄ test_postgres.py           # –¢–µ—Å—Ç—ã –¥–ª—è postgres.py
‚îÇ
‚îú‚îÄ‚îÄ example.env                    # –ü—Ä–∏–º–µ—Ä .env-—Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ main.py                        # –ì–ª–∞–≤–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Makefile                       # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Å–±–æ—Ä–∫–∏, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ poetry.lock                    # –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Poetry
‚îú‚îÄ‚îÄ pyproject.toml                 # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–æ–µ–∫—Ç–∞ (Poetry + –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
‚îú‚îÄ‚îÄ README.md                      # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–æ–ø–∏—Å–∞–Ω–∏–µ, —É—Å—Ç–∞–Ω–æ–≤–∫–∞, –∑–∞–ø—É—Å–∫)
‚îÇ
‚îú‚îÄ‚îÄ repositories                   # –†–∞–±–æ—Ç–∞ —Å –º–æ–¥–µ–ª—è–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ –±–∞–∑–æ–π (—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                # –î–µ–ª–∞–µ—Ç –ø–∞–ø–∫—É –º–æ–¥—É–ª–µ–º Python
‚îÇ   ‚îú‚îÄ‚îÄ models                     # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è ORM-–º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py                # –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, Base –¥–ª—è SQLAlchemy)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py            # –ò–º–ø–æ—Ä—Ç –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py                # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ test_user.py               # –¢–µ—Å—Ç—ã –¥–ª—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îî‚îÄ‚îÄ user.py                    # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π (CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏) –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ
‚îú‚îÄ‚îÄ routers                        # –†–æ—É—Ç–µ—Ä—ã (—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã FastAPI)
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                    # –ú–∞—Ä—à—Ä—É—Ç—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ª–æ–≥–∏–Ω)
‚îÇ   ‚îú‚îÄ‚îÄ decorators                 # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py            # –î–µ–ª–∞–µ—Ç –ø–∞–∫–µ—Ç –º–æ–¥—É–ª–µ–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_transaction.py    # –¢–µ—Å—Ç—ã –¥–ª—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transaction.py         # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py                # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞ —Ä–æ—É—Ç–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ middlewares                # Middleware-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã FastAPI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py            # –î–µ–ª–∞–µ—Ç –ø–∞–∫–µ—Ç –º–æ–¥—É–ª–µ–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logging.py             # Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test_logging.py        # –¢–µ—Å—Ç—ã –¥–ª—è logging middleware
‚îÇ   ‚îî‚îÄ‚îÄ test_auth.py               # –¢–µ—Å—Ç—ã –¥–ª—è —Ä–æ—É—Ç–æ–≤ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îÇ
‚îú‚îÄ‚îÄ schemas                        # Pydantic-—Å—Ö–µ–º—ã (–≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö, DTO)
‚îÇ   ‚îú‚îÄ‚îÄ auth.py                    # –°—Ö–µ–º—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (LoginRequest, RegisterResponse –∏ —Ç.–ø.)
‚îÇ   ‚îî‚îÄ‚îÄ __init__.py                # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞ —Å—Ö–µ–º
‚îÇ
‚îî‚îÄ‚îÄ services                       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    ‚îú‚îÄ‚îÄ auth.py                    # –°–µ—Ä–≤–∏—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è –∏ —Ç.–ø.)
    ‚îú‚îÄ‚îÄ __init__.py                # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
    ‚îî‚îÄ‚îÄ test_auth.py               # –¢–µ—Å—Ç—ã –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
```